<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Chúc mừng 20/10</title>

  <link href="https://fonts.googleapis.com/css2?family=Mali:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- Nhập tên -->
  <div class="name-input" id="nameInputContainer">
    <h2>Nhập tên của người nhận 🎀</h2>
    <input type="text" id="nameInput" placeholder="Nhập tên..." />
    <button id="startBtn">Bắt đầu</button>
  </div>

  <!-- Thông điệp chúc mừng -->
  <div class="center-message" id="mainContent" style="display:none;">
    <strong>Chúc mừng 20-10</strong>
    <span id="centerText">
      Ngày Phụ nữ Việt Nam<br>
      Mong người đẹp luôn rạng rỡ như những bó hoa!
    </span>
  </div>

  <!-- Ảnh động trang trí -->
  <img src="mewmew.gif" alt="GIF" class="center-gif" />

  <!-- Popup lời chúc -->
  <div class="popup" id="popup">
    <div class="popup-content">
      <img id="popupImage" src="" alt="Lời chúc">
      <p id="popupMessage">Lời chúc ở đây</p>
    </div>
  </div>
  <div class="overlay" id="overlay"></div>

  <!-- Nhạc nền -->
  <audio id="player" src="a.mp3"></audio>

  <!-- Script -->
  <script>
    let userName = "";

    const messages = [
      { img: "a1.jpg", text: "Chúc bạn luôn vui vẻ, xinh đẹp và ngập tràn yêu thương!" },
      { img: "a2.jpg", text: "Mỗi ngày của bạn đều là một đoá hoa nở rộ." },
      { img: "a3.jpg", text: "Cảm ơn bạn vì đã luôn mạnh mẽ và tuyệt vời như thế!" },
      { img: "a4.jpg", text: "Chúc bạn một ngày 20/10 thật hạnh phúc và trọn vẹn!" },
      { img: "a5.jpg", text: "Bạn là món quà tuyệt vời nhất mà cuộc sống mang lại!" }
    ];

    const popup = document.getElementById("popup");
    const overlay = document.getElementById("overlay");
    const popupImage = document.getElementById("popupImage");
    const popupMessage = document.getElementById("popupMessage");
    const centerText = document.getElementById("centerText");

    const letterImages = [
      "letters.png",
      "q3.png",
      "h1.png",
      "h3.png",
      "t2.png",
      "t5.png",
    ];

    // === CƠ CHẾ NHẬP TÊN ===
    document.getElementById("startBtn").addEventListener("click", () => {
      const nameField = document.getElementById("nameInput");
      const name = nameField.value.trim();
      if (!name) {
        alert("Vui lòng nhập tên trước khi bắt đầu!");
        return;
      }
      userName = name;

      document.getElementById("nameInputContainer").style.display = "none";
      document.getElementById("mainContent").style.display = "block";

      // bắt đầu hiệu ứng
      setInterval(() => createFallingLetter(), 1000);
    });

    function createHeartExplosion(x, y) {
      const hearts = ['💗'];
      const numHearts = 12;

      for (let i = 0; i < numHearts; i++) {
        const heart = document.createElement('div');
        heart.classList.add('heart');
        heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];

        const angle = (Math.PI * 2 / numHearts) * i;
        const distance = Math.random() * 80 + 40;

        heart.style.left = x + 'px';
        heart.style.top = y + 'px';
        heart.style.setProperty('--dx', Math.cos(angle) * distance + 'px');
        heart.style.setProperty('--dy', Math.sin(angle) * distance + 'px');
        heart.style.fontSize = (Math.random() * 10 + 20) + 'px';

        document.body.appendChild(heart);
        setTimeout(() => heart.remove(), 2000);
      }
    }

    function createFallingLetter() {
      const letter = document.createElement("img");
      const randomImage = letterImages[Math.floor(Math.random() * letterImages.length)];
      letter.src = randomImage;
      letter.classList.add("falling-letter");
      letter.style.left = Math.random() * (window.innerWidth - 50) + "px";
      letter.addEventListener("click", (e) => {
        createHeartExplosion(e.clientX, e.clientY);
        letter.classList.add('letter-clicked');
        setTimeout(() => showPopup(), 300);
      });

      document.body.appendChild(letter);
      setTimeout(() => letter.remove(), 8000);
    }

    function showPopup() {
      const randomMessage = messages[Math.floor(Math.random() * messages.length)];
      const personalizedText = randomMessage.text.replace(/bạn/g, userName);
      popupImage.src = randomMessage.img;
      popupMessage.textContent = personalizedText;
      popup.style.display = "block";
      overlay.classList.add("active");
      popup.dataset.currentMessage = personalizedText;
    }

    function closePopup() {
      popup.style.display = "none";
      overlay.classList.remove("active");
      if (popup.dataset.currentMessage) {
        centerText.innerHTML = popup.dataset.currentMessage;
      }
    }

    overlay.addEventListener("click", closePopup);

    document.body.addEventListener("click", function () {
      const player = document.getElementById("player");
      if (player.paused) player.play();
    });
  </script>
</body>
</html>
